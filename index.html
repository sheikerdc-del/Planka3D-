<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Планка — профиль, стоимость, 3D (ES Modules)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><rect width=%2216%22 height=%2216%22 rx=%223%22 fill=%22%230b132b%22/><path d=%22M3 11L8 3l5 8H3z%22 fill=%22%235bc0be%22/></svg>">

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <style>
    :root { --bg:#0b132b; --card:#111833; --muted:#aeb6c7; --line:#2a3558; --text:#f3f4f7; --accent:#5bc0be; --ink:#0b1020; --paper:#fff; }
    html, body { height:100%; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    h1 { font-size:22px; font-weight:800; margin:16px; }
    .container { display:flex; flex-direction:column; gap:16px; padding:0 16px 24px; max-width:1400px; margin:0 auto; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:16px; }
    .section-title { font-weight:800; font-size:16px; margin:4px 0 10px; }
    .small { font-size:13px; color:var(--muted); }
    .muted { color:var(--muted); }
    .row { display:flex; gap:12px; flex-wrap:wrap; width:100%; }
    .field { display:flex; flex-direction:column; gap:6px; flex:1 1 220px; min-width:220px; }
    label { font-size:13px; color:var(--muted); font-weight:700; }
    input[type=number], select { width:100%; box-sizing:border-box; background:#0f1533; color:#f3f4f7; border:1px solid #3a4780; border-radius:10px; padding:12px; font-size:14px; outline:none; }
    input[type=number]:focus, select:focus { border-color:#7aa2ff; box-shadow:0 0 0 3px rgba(122,162,255,.18); }
    .checkbox { display:flex; align-items:center; gap:8px; }
    .btns { display:flex; gap:8px; flex-wrap:wrap; }
    button { appearance:none; border:1px solid #34406d; background:#10173a; color:#f3f4f7; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:800; font-size:14px; }
    button.primary { background:linear-gradient(180deg,#203061,#0f1a3a); border-color:#33406b; }
    button.danger { background:linear-gradient(180deg,#4b1c1c,#2a1111); border-color:#6b3333; }
    svg.canvas, svg.grid { width:100%; height:360px; background:#0d1430; border:1px solid var(--line); border-radius:10px; overflow:hidden; }
    #viewer3d { width:100%; height:480px; border:1px solid var(--line); border-radius:10px; background:#0d1430; }
    table { width:100%; border-collapse:collapse; table-layout:fixed; }
    th, td { border-bottom:1px solid var(--line); padding:8px; font-size:13px; color:#eef1ff; }
    th { text-align:left; color:#fff; font-weight:800; }
    td input[type=number] { width:100%; padding:8px 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:13px; white-space: pre; }
    @media (max-width: 720px) { .field { min-width: 160px; } }
  </style>
</head>
<body>
  <h1>Планка — единая форма (профиль + стоимость + 3D)</h1>
  <div class="container">

    <div class="card">
      <div class="section-title">Редактор по точкам (ЛКМ — добавить/перетащить; ПКМ — удалить последнюю)</div>
      <svg id="pointCanvas" class="canvas" viewBox="0 0 800 360"></svg>
      <div class="btns" style="margin-top:8px;">
        <button id="applyFromPoints" class="primary">Применить к профилю</button>
        <button id="importToPoints">Импорт из профиля</button>
        <button id="clearPoints" class="danger">Очистить</button>
      </div>
      <div class="section-title" style="margin-top:10px;">Длины и углы (из редактора)</div>
      <table>
        <thead><tr><th style="width:40px">#</th><th>Длина, мм</th><th>Угол, °</th></tr></thead>
        <tbody id="pointsTable"></tbody>
      </table>
    </div>

    <div class="card">
      <div class="section-title">Параметры профиля</div>
      <div class="row">
        <div class="field">
          <label>Минимальная длина полки, мм</label>
          <input type="number" id="minFlange" value="8" min="1" step="1">
        </div>
        <div class="field">
          <label>Сторона завальцовки</label>
          <select id="hemSide" disabled>
            <option value="bottom">Снизу (от нижней кромки)</option>
            <option value="top">Сверху (от верхней кромки)</option>
          </select>
        </div>
      </div>
      <div class="checkbox" style="margin-top:8px;">
        <input type="checkbox" id="useHem">
        <label for="useHem">Использовать завальцовку 15 мм</label>
      </div>
      <div class="btns" style="margin-top:8px;">
        <button id="recalc" class="primary">Пересчитать</button>
        <button id="addFlange">Добавить полку</button>
        <button id="removeFlange" class="danger">Удалить последнюю</button>
        <span class="small" id="countInfo" style="align-self:center;"></span>
      </div>
      <div id="warnings" class="small" style="margin-top:6px;"></div>

      <div class="section-title" style="margin-top:14px;">Длины и углы (профиль)</div>
      <div id="profileList"></div>
    </div>

    <div class="card" id="priceCard">
      <div class="section-title">Стоимость</div>
      <div class="small">Ширина изделия берётся из текущего профиля (Σ).</div>

      <div class="row">
        <div class="field">
          <label>Ширина изделия, мм (из профиля)</label>
          <input type="number" id="shirina" readonly>
        </div>
        <div class="field">
          <label>Длина изделия</label>
          <select id="dlina">
            <option value="0">— выберите —</option>
            <option value="do1250">До 1250 мм</option>
            <option value="bolee1250">От 1250 до 2000 мм</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Покрытие</label>
          <select id="pokritie">
            <option value="0">Выберите покрытие</option>
            <option value="1">РЕ РФ 0.45</option>
            <option value="2">VikingMP Д 0.45</option>
            <option value="3">Purman 0.50</option>
            <option value="4">VikingMP E 0.50</option>
          </select>
        </div>
        <div class="field">
          <label>Цвет</label>
          <select id="color">
            <option data-filter="0" value="0">Выберите цвет</option>
            <option data-filter="1" value="1592.5">9003</option>
            <option data-filter="1" value="1592.5">6005</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Количество изделий, шт</label>
          <input type="number" id="kolichestvo" min="1" step="1" value="1">
        </div>
      </div>

      <div class="small" style="margin-top:6px;">Категория цены клиента</div>
      <div class="btns" id="priceCats">
        <button type="button" class="btn" data-mult="2.8" data-name="11">11</button>
        <button type="button" class="btn" data-mult="2.4" data-name="22">22</button>
        <button type="button" class="btn" data-mult="1.57" data-name="32">32</button>
      </div>

      <div style="margin-top:10px;">
        <div class="section-title">Цена за изделие</div>
        <div id="cost" style="font-size:20px;font-weight:800;">—</div>
      </div>
      <div id="supplyInfo" class="small" style="margin-top:8px;"></div>
    </div>

    <div class="card">
      <div class="section-title">2D профиль и полоса</div>
      <div class="row">
        <div class="field" style="flex:1 1 360px; min-width:360px;">
          <svg id="cross" class="grid" viewBox="0 0 700 360"></svg>
        </div>
        <div class="field" style="flex:1 1 360px; min-width:360px;">
          <svg id="flat" class="grid" viewBox="0 0 820 360"></svg>
        </div>
      </div>
      <div class="btns" style="margin-top:8px;">
        <button id="exportCross">Экспорт SVG (профиль)</button>
        <button id="exportFlat">Экспорт SVG (полоса)</button>
        <button id="exportProd" class="primary">Экспорт SVG (производство)</button>
      </div>
    </div>

    <div class="card">
      <div class="section-title">Данные по ширине и разметке</div>
      <div id="widthInfo"></div>
      <div class="section-title" style="margin-top:10px;">Разметка (линии гиба)</div>
      <div id="layoutTable" class="mono"></div>
    </div>

    <div class="card">
      <div class="section-title">3D предпросмотр</div>
      <div id="viewer3d"></div>
    </div>

  </div>

  <script type="module" src="./main.js"></script>
</body>
</html>
